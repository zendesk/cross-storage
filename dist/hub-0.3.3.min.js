/**
 * cross-storage - Cross domain local storage
 *
 * @version   0.3.3
 * @link      https://github.com/zendesk/cross-storage
 * @author    Daniel St. Jules <danielst.jules@gmail.com>
 * @copyright Zendesk
 * @license   Apache-2.0
 */

var CrossStorageHub={};CrossStorageHub.init=function(e){try{if(!window.localStorage)return}catch(r){return}CrossStorageHub._permissions=e||[],CrossStorageHub._installListener(),window.parent.postMessage("ready","*")},CrossStorageHub._installListener=function(){var e=CrossStorageHub._listener;window.addEventListener?window.addEventListener("message",e,!1):window.attachEvent("onmessage",e)},CrossStorageHub._listener=function(e){var r,t,o,s;if("poll"===e.data)return window.parent.postMessage("ready",e.origin);if("ready"!==e.data){if(r=JSON.parse(e.data),CrossStorageHub._permitted(e.origin,r.method))try{o=CrossStorageHub["_"+r.method](r.params)}catch(n){t=n.message}else t="Invalid permissions for "+r.method;s=JSON.stringify({id:r.id,error:t,result:o}),window.parent.postMessage(s,e.origin)}},CrossStorageHub._permitted=function(e,r){var t,o,s,n;if(t=["get","set","del","getKeys"],!CrossStorageHub._inArray(r,t))return!1;for(o=0;o<CrossStorageHub._permissions.length;o++)if(s=CrossStorageHub._permissions[o],s.origin instanceof RegExp&&s.allow instanceof Array&&(n=s.origin.test(e),n&&CrossStorageHub._inArray(r,s.allow)))return!0;return!1},CrossStorageHub._set=function(e){var r,t;if(r=e.ttl,r&&parseInt(r,10)!==r)throw new Error("ttl must be a number");t={value:e.value},r&&(t.expire=CrossStorageHub._now()+r),window.localStorage.setItem(e.key,JSON.stringify(t))},CrossStorageHub._get=function(e){var r,t,o,s,n;for(r=window.localStorage,t=[],o=0;o<e.keys.length;o++)n=e.keys[o],s=JSON.parse(r.getItem(n)),null===s?t.push(null):s.expire&&s.expire<CrossStorageHub._now()?(r.removeItem(n),t.push(null)):t.push(s.value);return t.length>1?t:t[0]},CrossStorageHub._del=function(e){for(var r=0;r<e.keys.length;r++)window.localStorage.removeItem(e.keys[r])},CrossStorageHub._getKeys=function(){var e,r,t;for(t=[],r=window.localStorage.length,e=0;r>e;e++)t.push(window.localStorage.key(e));return t},CrossStorageHub._inArray=function(e,r){for(var t=0;t<r.length;t++)if(e===r[t])return!0;return!1},CrossStorageHub._now=function(){return"function"==typeof Date.now?Date.now():(new Date).getTime()};