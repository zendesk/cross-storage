/**
 * cross-storage - Cross domain local storage
 *
 * @version   0.6.0
 * @link      https://github.com/zendesk/cross-storage
 * @author    Daniel St. Jules <danielst.jules@gmail.com>
 * @copyright Zendesk
 * @license   Apache-2.0
 */

var CrossStorageHub={};CrossStorageHub.init=function(r){var e=!0;try{window.localStorage||(e=!1)}catch(o){e=!1}if(!e)try{return window.parent.postMessage("cross-storage:unavailable","*")}catch(o){return}CrossStorageHub._permissions=r||[],CrossStorageHub._installListener(),window.parent.postMessage("cross-storage:ready","*")},CrossStorageHub._installListener=function(){var r=CrossStorageHub._listener;window.addEventListener?window.addEventListener("message",r,!1):window.attachEvent("onmessage",r)},CrossStorageHub._listener=function(r){var e,o,t,s,a;if("cross-storage:poll"===r.data)return window.parent.postMessage("cross-storage:ready",r.origin);if("cross-storage:ready"!==r.data&&(e=JSON.parse(r.data),o=e.method.split("cross-storage:")[1])){if(CrossStorageHub._permitted(r.origin,o))try{s=CrossStorageHub["_"+o](e.params)}catch(n){t=n.message}else t="Invalid permissions for "+o;a=JSON.stringify({id:e.id,error:t,result:s}),window.parent.postMessage(a,r.origin)}},CrossStorageHub._permitted=function(r,e){var o,t,s,a;if(o=["get","set","del","clear","getKeys"],!CrossStorageHub._inArray(e,o))return!1;for(t=0;t<CrossStorageHub._permissions.length;t++)if(s=CrossStorageHub._permissions[t],s.origin instanceof RegExp&&s.allow instanceof Array&&(a=s.origin.test(r),a&&CrossStorageHub._inArray(e,s.allow)))return!0;return!1},CrossStorageHub._set=function(r){var e,o;if(e=r.ttl,e&&parseInt(e,10)!==e)throw new Error("ttl must be a number");o={value:r.value},e&&(o.expire=CrossStorageHub._now()+e),window.localStorage.setItem(r.key,JSON.stringify(o))},CrossStorageHub._get=function(r){var e,o,t,s,a;for(e=window.localStorage,o=[],t=0;t<r.keys.length;t++)a=r.keys[t],s=JSON.parse(e.getItem(a)),null===s?o.push(null):s.expire&&s.expire<CrossStorageHub._now()?(e.removeItem(a),o.push(null)):o.push(s.value);return o.length>1?o:o[0]},CrossStorageHub._del=function(r){for(var e=0;e<r.keys.length;e++)window.localStorage.removeItem(r.keys[e])},CrossStorageHub._clear=function(){window.localStorage.clear()},CrossStorageHub._getKeys=function(){var r,e,o;for(o=[],e=window.localStorage.length,r=0;e>r;r++)o.push(window.localStorage.key(r));return o},CrossStorageHub._inArray=function(r,e){for(var o=0;o<e.length;o++)if(r===e[o])return!0;return!1},CrossStorageHub._now=function(){return"function"==typeof Date.now?Date.now():(new Date).getTime()};